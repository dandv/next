{
  "name" : "qooxdoo framework configuration",

  "include" :
  [
    {
      "path" : "${QOOXDOO_PATH}/tool/data/config/application.json"
    },

    {
      "path" : "image.json"
    }
  ],

  "export":
  [
    "api-data",
    "api-verify",
    "build-all",
    "dependencies",
    "clean",
    "clean-cache",
    "compile-framework-scss",
    "distclean",
    "fix",
    "images",
    "info",
    "lint",
    "lint-test",
    "provider",
    "pretty-test",
    "source-all",
    "test",
    "test-source",
    "validate-config",
    "validate-manifest",
    "watch-scss"
  ],


  "let" :
  {
    "APPLICATION"  : "qx",
    "QOOXDOO_PATH" : "..",
    "API_INCLUDE"    : ["q", "qxWeb", "qx.*"],
    "API_EXCLUDE"  : ["qx.test.*"],
    "TEST_INCLUDE" : "qx.test.*",
    "CACHE"        : "${TMPDIR}/qx${QOOXDOO_VERSION}/cache"
  },

  "config-warnings" :
  {
    "job-shadowing" :
    [
      "api",
      "common",
      "dependencies",
      "lint",
      "provider-deps",
      "provider-classes",
      "source-all",
      "test",
      "test-source",
      "testrunner::tests-common"
    ]
  },

  "jobs":
  {

    "build-all" :
    {
      "library" :
      [
        {
          "manifest" : "Manifest.json"
        }
      ],

      "extend" : [ "cache" ],

      "include": ["qx.*"],
      "exclude": ["qx.test.*", "qx.Part", "qx.io.part.*", "qx.dev.unit.Sinon"],

      "environment" :
      {
        "qx.debug" : false,
        "qx.aspects" : false
      },

      "compile-options" :
      {
        "paths" :
        {
          "file"     : "build/script/qx.js",
          "app-root" : "./build",
          "loader-template" : "../tool/data/generator/website.loader.tmpl.js"
        },
        "code"  :
        {
          "format"   : false,
          "except"   : [],
          "optimize" : ["basecalls", "variables", "privates", "strings", "whitespace", "variants"]
        }
      },

      "compile" : { "type" : "build" },

      "copy-resources" :
      {
        "target" : "build"
      },

      "config-warnings" :
      {
        "exclude" : ["qx.test.*", "qx.Part", "qx.io.part.*", "qx.core.Init"]
      }
    },

    "source-all": {

      "=include": ["qx.*"],
      "=exclude": ["qx.test.*", "qx.Part", "qx.io.part.*", "qx.dev.unit.Sinon"],

      "compile-options": {
        "paths" :
        {
          "file"     : "source/script/qx-source.js",
          "app-root" : "${BUILD_PATH}",
          "loader-template" : "../tool/data/generator/website.loader.source.tmpl.js"
        }
      }
    },

    // suppress addtl. lint checks when building with framework classes
    "no-compile-lint" : {
      "compile-options" : {
        "code" : {
          "lint-check" : false
        }
      }
    },


    // -- Test Jobs ------------------------------------------------------------

    // This one is used in all jobs relating to the generated AUT
    "testrunner::tests-common" :
    {
      "extend" : [ "no-compile-lint" ],
      "environment" :
      {
        "qx.test.bool_true" : true,
        "qx.test.bool_false" : false
      }
    },

    "test" :
    {
      "extend" : [ "no-compile-lint" ],
      "config-warnings" : {
        "environment" : ["non-literal-keys"]
      },
      "run" : ["test-copy-files"],

      "let" :
      {
        "LOCALES" : ["de", "de_DE", "en", "en_GB", "en_US"]
      }
    },

    "test-copy-files" :
    {
      "extend" : [ "cache" ],

      "copy-files" :
      {
        "files"    : [ "test" ],
        "source"   : "source/resource/qx",
        "target"   : "test/resource/qx"
      }
    },


    "test-source" :
    {
      "extend" : [ "no-compile-lint" ],
      "let" :
      {
        "LOCALES" : ["de", "de_DE", "en", "en_GB", "en_US"]
      }
    },


    "provider-classes" :
    {
      "provider" :
      {
        "include" : [ "q", "qxWeb" ]
      }
    },

    "provider-deps" :
    {
      "include" : [ "q", "qxWeb" ]
    },

    "images" :
    {
      "desc" : "clip and combine all images used in the framework",
      "run" : [ "image-clipping", "image-combine" ]
    },

    "lint" :
    {
      "exclude": ["qx.test.*"]
    },

    "lint-test" :
    {
      "include": ["=qx.test.*"]
    },

    "api-verify" :
    {
      "desc" : "Checks internal links in class comments. Also creates an XML sitemap with a link for each class",
      "extend" : [ "api-data" ],
      "api" : {
        "verify" : [ "links", "types", "statistics" ],
        "sitemap" :
        {
          "link-uri" : "http://api.qooxdoo.org/#%s",
          "file" : "api/sitemap.xml"
        }
      }
    },

    "watch-scss" :
    {
      "desc": "Watch and compile the theme scss",
      "extend": ["cache"],
      "let": {
        "QX_SHARED_THEME_PATH": "source/resource/qx/scss"
      },
      "shell": {
        "command": "sass -C -t compressed -I ${QX_SHARED_THEME_PATH} --watch ${QX_SHARED_THEME_PATH}/scss:${QX_SHARED_THEME_PATH}/css"
      }
    },

    "pretty-test" :
    {
      "desc" : "This is just to test pretty-printing - don't commit after running.",
      "extend" : ["pretty"]
    },

    "dependencies" :
    {
      "=exclude" : [ "${APPLICATION}.test.*" ]
    }
  }
}
